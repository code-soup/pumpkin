# Pumpkin [Big Alpha Release]
### Next generation WordPress Theme boilerplate concept

This software is provided "as is" without any warranties, express or implied. The project is currently in active development and may contain bugs or incomplete features.
Part of readme is generated by AI and because of frequent updates might not be up to date.

Designed around component-based architecture and DRY principles for better code organization and reusability. Note that this approach may not follow traditional WordPress theme patterns.
It's a collection of best practices for streamlined theme development and long term maintenance.

**âš ï¸ Important**: This theme requires ACF Pro (paid plugin). You must purchase your own ACF Pro license separately. This project is not affiliated with or endorsed by ACF in any way.

Feedback welcome, contributions are not accepted at this stage.
More examples on how to use this boilerplate will be provided soon.

## Key concepts:

#### Folder based template loader with per-page-template overrides
Template becomes visible for selection as soon as folder is created.
(Old way WordPress loads templates still works but might break some plugins)

    1. /templates/post-type/{post-type}/{template-name}/index.php
    2. /templates/post-type/{post-type}/index.php 

Or you can override only part of the template, in this loading order:

    1. /templates/post-type/{post-type}/{template-name}/footer.php => Page template specific footer.php
    2. /templates/post-type/{post-type}/footer.php                 => Post type specific footer.php
    3. /templates/shared/footer.php                                => Default footer.php

#### Per page-template/post-type specific css/js bundle
All files related to a specifc template are saved inside same page-template folder.
When you delete template, everything is gone at once, no dead code floating around.

```
templates/{post-type}/{template-name}/
â”œâ”€â”€ ğŸ“ assets/
â”‚   â”œâ”€â”€ ğŸ“ images/                    # Page specific images
â”‚   â””â”€â”€ ğŸ“ icons/                     # Page specific icons
â”œâ”€â”€ ğŸ“ scss/                          # Page specific SCSS
â”‚   â””â”€â”€ ğŸ“ sections/                  # Section specific SCSS
â”œâ”€â”€ ğŸ“ js/                            # Page specific JavaScript
â”œâ”€â”€ ğŸ“ sections/                      # PHP/HTML template for each section
â”œâ”€â”€ ğŸ“„ index.php                      # Main page template file
â”œâ”€â”€ ğŸ“„ index.scss                     # Dynamic Webpack entrypoint
â”œâ”€â”€ ğŸ“„ index-async.scss               # Dynamic Webpack entrypoint (deferred)
â”œâ”€â”€ ğŸ“„ index.js                       # Dynamic Webpack entrypoint
â””â”€â”€ ğŸ“„ index-async.js                 # Dynamic Webpack entrypoint (deferred)
```


Webpack script looks for page templates on build, based on index.scss/js index-async.scss/js, bundles it and script-loader class is loading appropriate css/js per page template.

Appending `-async` to index.scss/js filename makes bundled loading is defered.
common/shared scss/js is manually added in config.user.js, in webpack config folder.

#### ACF Flexible Field
- Used to create reusable sections, ACF Admin categories to organize them
- Each section of page is created as a specific ACF Field group and then added to `Sections` Flexible Field as a Clone.
- Field values are retrieved with helper PHP class

#### Theme Options to Post Type
Saved with ACF into custom post type.
Fields are assigned by specifying page-template, load and access options with PHP helper class.
You can still use traditional ACF options pages where required

#### Global PHP config
Because some things don't need to be editable trough WP Admin theme comes with global page-config.php with hardcoded options, which can be overrided for each template using same template hierarchy fallback.


#### Reusable static compoments
Reusable components that don't need to be edited in WP admin, with custom PHP abstract class to reuse them across the site and add new ones using same pattern.
All files required files for this component are saved in component folder, you include css/js in custom page template where required.

    templates/shared/components/website-logo/Component.php
    
    Usage in template:
    <?php echo \CodeSoup\Pumpkin\Components\WebsiteLogo\Component::render(); ?>

### Requirements:
- PHP 8.2+, WordPress 6.x
- Node.js >= 22, npm
- ACF Pro

## Quick Start

1.  **Clone the Repository**:
    ```bash
    git clone https://github.com/code-soup/pumpking.git my-awesome-theme
    cd my-awesome-theme
    ```

2.  **Configure ACF Pro License**:
    Create an `auth.json` file in the theme root with your ACF Pro license credentials:
    ```json
    {
        "http-basic": {
            "connect.advancedcustomfields.com": {
                "username": "YOUR_ACF_LICENSE_KEY",
                "password": "YOUR_ACF_LICENSE_URL"
            }
        }
    }
    ```
    > **Note**: Get your license credentials from your [ACF Pro account page](https://www.advancedcustomfields.com/my-account/).

3.  **Environment Configuration** (Optional):
    Create a `.env` file for environment-specific settings:
    ```bash
    # Development settings
    WP_DEV_URL=http://localhost # Where your WordPress theme is installed
    WP_CONTENT_PATH=/wp-content/themes # Sepcify custom themes folder if different from default
    ```

4.  **Run the Setup Script**:
    This script will ask for your theme's details and configure the boilerplate files for you.
    ```bash
    npm run setup
    ```

5.  **Install Dependencies**:
    Once the setup is complete, install the necessary PHP and Node.js dependencies.
    ```bash
    # Install PHP dependencies (includes ACF Pro)
    composer install

    # Install Node.js dependencies
    npm install
    ```

6.  **Run the Development Server**:
    For live-reloading and automatic recompilation of assets during development.
    ```bash
    npm run dev
    ```

## Available Scripts

This boilerplate comes with a set of pre-configured scripts for development tasks.

### PHP Scripts (via Composer)

-   **`composer lint`**: Lints all PHP files for syntax errors.
-   **`composer wpcs`**: Checks PHP files against the WordPress Coding Standards.
-   **`composer cbf`**: Automatically fixes many `phpcs` errors.

### JavaScript/Asset Scripts (via npm)

-   **`npm run setup`**: Initial plugin setup
-   **`npm run dev`**: Starts the webpack dev server with Hot Module Replacement.
-   **`npm run build`**: Compiles and optimizes all assets for a production environment.
-   **`npm run build:dev`**: Compiles assets for development without optimization.
-   **`npm run lint`**: Runs both the script and style linters.
    -   **`npm run lint:scripts`**: Lints JavaScript files with ESLint.
    -   **`npm run lint:styles`**: Lints SCSS files with Stylelint.
-   **`npm run clean`**: Deletes the `dist` folder and the webpack cache.

## Folder Structure

```
pumpkin/
â”œâ”€â”€ ğŸ“ dist/                          # Compiled assets (auto-generated)
â”‚   â”œâ”€â”€ manifest.json                 # Webpack asset manifest
â”‚   â”œâ”€â”€ scripts/                      # Compiled JavaScript bundles
â”‚   â””â”€â”€ styles/                       # Compiled CSS bundles
â”‚
â”œâ”€â”€ ğŸ“ includes/                      # Core PHP functionality
â”‚   â”œâ”€â”€ ğŸ“ acf/                       # ACF integration classes
â”‚   â”‚   â”œâ”€â”€ class-acf-options.php     # ACF integration for options handling
â”‚   â”‚   â”œâ”€â”€ class-options.php         # ACF options handling
â”‚   â”‚   â”œâ”€â”€ class-sections.php        # Flexible content sections
â”‚   â”‚   â”œâ”€â”€ class-setup.php           # ACF configuration
â”‚   â”‚   â””â”€â”€ json/                     # ACF field group exports
â”‚   â”œâ”€â”€ ğŸ“ core/                      # Core theme classes
â”‚   â”‚   â”œâ”€â”€ class-bootstrap.php       # Theme initialization
â”‚   â”‚   â”œâ”€â”€ class-component.php       # Component base class
â”‚   â”‚   â”œâ”€â”€ class-hooker.php          # WordPress hooks manager
â”‚   â”‚   â””â”€â”€ class-page-config.php     # Page configuration handler
â”‚   â”œâ”€â”€ ğŸ“ plugin-mods/               # Third-party plugin modifications
â”‚   â”œâ”€â”€ ğŸ“ utils/                     # Utility classes and traits
â”‚   â”‚   â”œâ”€â”€ html-helpers.php          # HTML generation helpers
â”‚   â”‚   â”œâ”€â”€ trait-asset-loader.php    # Asset loading functionality
â”‚   â”‚   â”œâ”€â”€ trait-script-loader.php   # Script loading utilities
â”‚   â”‚   â””â”€â”€ trait-template-utilities.php # Template helper functions
â”‚   â””â”€â”€ ğŸ“ wp-mods/                   # WordPress core modifications
â”‚       â”œâ”€â”€ class-script-loader.php   # Custom script loading system
â”‚       â”œâ”€â”€ class-template-admin.php  # Template admin interface
â”‚       â”œâ”€â”€ class-template-loader.php # Custom template loading system
â”‚       â””â”€â”€ class-theme-setup.php     # WordPress theme setup
â”‚
â”œâ”€â”€ ğŸ“ lang/                          # Translation files
â”‚   â””â”€â”€ pumpkin.pot                   # Translation template
â”‚
â”œâ”€â”€ ğŸ“ src/                           # Source assets (pre-compilation)
â”‚   â”œâ”€â”€ ğŸ“ config/                    # Build configuration
â”‚   â”‚   â”œâ”€â”€ config.user.js            # User-specific webpack config
â”‚   â”‚   â”œâ”€â”€ config.webpack.js         # Main webpack configuration
â”‚   â”‚   â””â”€â”€ ğŸ“ webpack/               # Webpack module configurations
â”‚   â”‚       â”œâ”€â”€ config.module.js      # Module rules
â”‚   â”‚       â”œâ”€â”€ config.optimization.js # Optimization settings
â”‚   â”‚       â”œâ”€â”€ config.plugins.js     # Webpack plugins
â”‚   â”‚       â””â”€â”€ ğŸ“ loaders/           # Asset loaders
â”‚   â”œâ”€â”€ ğŸ“ fonts/                     # Font files
â”‚   â”œâ”€â”€ ğŸ“ icons/                     # Icon assets
â”‚   â”œâ”€â”€ ğŸ“ images/                    # Global images
â”‚   â”œâ”€â”€ ğŸ“ scripts/                   # Global JavaScript
â”‚   â”‚   â”œâ”€â”€ admin.js                  # WordPress admin scripts
â”‚   â”‚   â”œâ”€â”€ main.js                   # Main frontend script
â”‚   â”‚   â””â”€â”€ ğŸ“ util/                  # JavaScript utilities
â”‚   â””â”€â”€ ğŸ“ styles/                    # Global SCSS
â”‚       â”œâ”€â”€ main.scss                 # Main stylesheet entry
â”‚       â”œâ”€â”€ admin.scss                # Admin stylesheet
â”‚       â”œâ”€â”€ ğŸ“ abstracts/             # SCSS variables, mixins, functions
â”‚       â”œâ”€â”€ ğŸ“ components/            # Global component styles
â”‚       â”œâ”€â”€ ğŸ“ core/                  # Base/reset styles
â”‚       â”œâ”€â”€ ğŸ“ layouts/               # Layout-specific styles
â”‚       â””â”€â”€ ğŸ“ sections/              # Section-specific styles
â”‚
â”œâ”€â”€ ğŸ“ templates/                     # Template system
â”‚   â”œâ”€â”€ ğŸ“ post-type/                 # Post type specific templates
â”‚   â”‚   â”œâ”€â”€ ğŸ“ page/                  # Page templates
â”‚   â”‚   â”‚   â”œâ”€â”€ index.php             # Default page template
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ 404/               # 404 page template
â”‚   â”‚   â”‚       â””â”€â”€ index.php         # 404 template file
â”‚   â”‚   â””â”€â”€ ğŸ“ post/                  # Post templates
â”‚   â”œâ”€â”€ ğŸ“ shared/                    # Shared template components
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/            # Reusable static components
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ website-logo/      # Example component
â”‚   â”‚   â”‚       â”œâ”€â”€ Component.php     # Component class
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“ assets/        # Component-specific assets
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“ templates/     # Component templates
â”‚   â”‚   â”œâ”€â”€ ğŸ“ parts/                 # Template parts (header, footer, etc.)
â”‚   â”‚   â””â”€â”€ ğŸ“ sections/              # ACF flexible content sections
â”‚   â””â”€â”€ ğŸ“ taxonomy/                  # Taxonomy templates
â”‚       â””â”€â”€ index.php                 # Default taxonomy template
â”‚
â”œâ”€â”€ ğŸ“ vendor/                        # Composer dependencies
â”‚   â”œâ”€â”€ ğŸ“ acf-admin-categories/      # ACF admin organization
â”‚   â”œâ”€â”€ ğŸ“ advanced-custom-fields-pro/ # ACF Pro plugin
â”‚   â””â”€â”€ autoload.php                  # Composer autoloader
â”‚
â”œâ”€â”€ ğŸ“„ base.php                       # Theme base template
â”œâ”€â”€ ğŸ“„ functions.php                  # WordPress functions file
â”œâ”€â”€ ğŸ“„ index.php                      # WordPress index template
â”œâ”€â”€ ğŸ“„ page-config.php                # Global page configuration
â”œâ”€â”€ ğŸ“„ style.css                      # WordPress theme header
â”œâ”€â”€ ğŸ“„ composer.json                  # PHP dependencies
â”œâ”€â”€ ğŸ“„ package.json                   # Node.js dependencies
â””â”€â”€ ğŸ“„ README.md                      # This file
```

### Key Directory Explanations

#### `/templates/` - Template System
The heart of Pumpkin's component-based architecture:

- **`post-type/{post-type}/{template-name}/`** - Each template gets its own folder containing all related files (PHP, SCSS, JS, images)
- **`shared/components/`** - Reusable static components with their own PHP classes
- **`shared/parts/`** - Traditional WordPress template parts (header, footer, sidebar)
- **`shared/sections/`** - ACF Flexible Content sections for page building

#### `/includes/` - Core Functionality
PHP classes that power the theme's features:

- **`core/`** - Essential theme classes (Bootstrap, Component base, Page config)
- **`acf/`** - ACF integration for flexible content and options
- **`wp-mods/`** - WordPress core modifications (custom template loader, script loader)
- **`utils/`** - Helper functions and traits for common tasks

#### `/src/` - Source Assets
Pre-compiled assets and build configuration:

- **`config/`** - Webpack configuration split into logical modules
- **`styles/`** - Global SCSS following ITCSS methodology
- **`scripts/`** - Global JavaScript and utilities

#### `/dist/` - Compiled Assets
Auto-generated by Webpack containing optimized, production-ready assets. Each page template gets its own bundle based on its `index.js/scss` files.

### Template Loading Hierarchy

Templates follow this loading order for maximum flexibility:

1. **Page-specific**: `/templates/post-type/{post-type}/{template-name}/index.php`
2. **Post-type default**: `/templates/post-type/{post-type}/index.php`
3. **Shared fallback**: `/templates/shared/index.php`

The same hierarchy applies to template parts (header.php, footer.php, etc.), allowing granular customization per template while maintaining DRY principles.

# Template Options Guide

This guide explains how to use the template-specific options feature in the Pumpkin theme.

## Overview

Template Options allow you to create ACF field groups for organizing theme options. Options are stored in a custom `pumpkin_options` post type (not in `wp_options` table), with all field values serialized and stored in the post's `post_content` field. This approach provides better organization, portability across domains, and easier management of related options.

## Setup

### 1. Define Template Options

Edit `includes/wp-mods/class-theme-setup.php` and add your template options to the `TEMPLATE_OPTIONS` constant:

```php
private const TEMPLATE_OPTIONS = [
    'footer' => 'Footer',
    'general' => 'General Options',
    'landing-page' => 'Landing Page Options',
    'contact' => 'Contact Form Options',
];
```

**Key:** Template name/slug (used internally, must be unique)  
**Value:** Display name (shown in WordPress admin)

### 2. Create ACF Field Groups

1. Go to **ACF â†’ Field Groups** in WordPress admin
2. Create a new field group and assign them to your "Pumpkin Options - Page Template"


### 3. Retrieve Options in Templates

Use the `Options` class to get values:

```php
// Get a single option value
$footer_text = \CodeSoup\Pumpkin\ACF\Options::get( 'footer', 'footer_text_field' );

// Get all options for a template
$footer_options = \CodeSoup\Pumpkin\ACF\Options::get( 'footer' );
```

## How It Works

1. **Registration:** When the theme initializes, `TEMPLATE_OPTIONS` are automatically registered
2. **Post Creation:** A `pumpkin_options` post is created for each template
3. **Storage:** All ACF field values are serialized and stored in the post's `post_content` field (not in `wp_options`)
4. **Portability:** Template names are stored in post meta, making them portable across domains
5. **ACF Integration:** Field groups are assigned to specific template options via location rules

### Storage Details

- **Post Type:** `pumpkin_options`
- **Storage Location:** Post `post_content` field (serialized)
- **Post Meta:** `_pumpkin_template_name` stores the template identifier
- **Advantage:** Options are grouped by template, easier to export/import, and don't clutter the `wp_options` table

## Example: Footer Options

### Step 1: Add to TEMPLATE_OPTIONS
```php
private const TEMPLATE_OPTIONS = [
    'footer' => 'Footer',
];
```

### Step 2: Create ACF Field Group
- Field Group Name: "Footer Settings"
- Fields:
  - `footer_text` (Text)
  - `footer_logo` (Image)
  - `footer_links` (Repeater)
- Location: Pumpkin Options - Page Template = Footer

### Step 3: Use in Template
```php
<?php
// Get individual field values from the pumpkin_options post
$footer_text = \CodeSoup\Pumpkin\ACF\Options::get( 'footer', 'footer_text' );
$footer_logo = \CodeSoup\Pumpkin\ACF\Options::get( 'footer', 'footer_logo' );

echo $footer_text;
echo wp_get_attachment_image( $footer_logo, 'full' );

// Or get all options for the template
$all_footer_options = \CodeSoup\Pumpkin\ACF\Options::get( 'footer' );
?>
```

**Note:** All values are retrieved from the `pumpkin_options` post's `post_content` field, not from `wp_options` table.

## Storage Architecture

### Why `pumpkin_options` Post Type?

Instead of storing options in the `wp_options` table (which can become cluttered), this system uses a custom post type:

- **Organization:** Related options are grouped in a single post
- **Portability:** Options are stored as post content, making them easy to export/import between domains
- **Scalability:** No performance impact on the `wp_options` table
- **Flexibility:** Each template can have its own set of options without conflicts

### Data Structure

```
pumpkin_options Post
â”œâ”€â”€ post_title: "Footer"
â”œâ”€â”€ post_content: [serialized ACF field values]
â”œâ”€â”€ post_meta:
â”‚   â””â”€â”€ _pumpkin_template_name: "footer"
â””â”€â”€ ACF Fields: footer_text, footer_logo, etc.
```


# Hooker

The `Hooker` class is a centralized service for adding WordPress actions and filters. It is registered in the Dependency Injection container and can be accessed from any class that has access to the container, such as a service provider or a class instantiated by one.

The primary benefit of using this service is to have a consistent, injectable way to manage WordPress hooks, which is useful for organization and testing.

## Basic Usage

### Getting the Hooker Instance

```php
// From Bootstrap
$hooker = \CodeSoup\Pumpkin\Core\Bootstrap::get_instance()->get_hooker();
```

### Adding Actions and Filters

```php
// Add a single action
$hooker->add_action( 'wp_footer', $this, 'render_footer' );

// Add a single filter
$hooker->add_filter( 'the_title', $this, 'modify_title', 10, 2 );

// Add multiple actions at once
$hooker->add_actions( [
    [ 'wp_enqueue_scripts', $this, 'enqueue_scripts' ],
    [ 'wp_footer', $this, 'render_footer', 20 ],
] );

// Add multiple filters at once
$hooker->add_filters( [
    [ 'the_content', $this, 'filter_content' ],
    [ 'the_title', $this ], // Method name matches hook name, can be omitted
    [ 'quick_edit_enabled_for_post_type', '__return_false' ], // Use WordPress built in global function
] );
```